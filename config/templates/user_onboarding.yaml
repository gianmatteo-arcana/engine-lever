# ============================================================================
# USER ONBOARDING TASK TEMPLATE
# PRD Lines 589-699: Task Template Structure
# 
# This template EXACTLY matches the PRD specification
# No business logic - pure declaration of WHAT needs to be achieved
# ============================================================================

task_template:
  id: "user_onboarding"
  version: "1.0.0"
  
  # PRD Lines 594-599: Metadata
  metadata:
    name: "New User Onboarding"
    description: "Collect business information for new users"
    category: "onboarding"
    estimatedDuration: 180  # seconds
  
  # PRD Lines 601-618: Declarative goals - WHAT to achieve
  goals:
    primary:
      - id: "create_user_profile"
        description: "Establish user identity and preferences"
        required: true
        
      - id: "collect_business_info"
        description: "Gather essential business details"
        required: true
        
      - id: "verify_entity"
        description: "Confirm business entity status"
        required: true
    
    secondary:
      - id: "connect_accounts"
        description: "Link QuickBooks or bank accounts"
        required: false
  
  # PRD Lines 621-631: State machine
  states:
    allowed:
      - "created"
      - "gathering_user_info"
      - "collecting_business_data"
      - "verifying_entity"
      - "completed"
      - "failed"
    
    initial: "created"
    terminal: ["completed", "failed"]
  
  # PRD Lines 634-648: Phases of execution
  phases:
    - id: "user_info"
      description: "Gather user information"
      prerequisites: []
      next: ["business_info"]
      
    - id: "business_info"
      description: "Collect business details"
      prerequisites: ["user_info"]
      next: ["entity_verification"]
      
    - id: "entity_verification"
      description: "Verify business entity"
      prerequisites: ["business_info"]
      next: ["complete"]
  
  # PRD Lines 651-678: Data schema for validation
  data_schema:
    type: "object"
    required: ["user", "business"]
    properties:
      user:
        type: "object"
        required: ["firstName", "lastName", "email"]
        properties:
          firstName:
            type: "string"
            minLength: 1
            maxLength: 100
          lastName:
            type: "string"
            minLength: 1
            maxLength: 100
          email:
            type: "string"
            format: "email"
            pattern: "^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$"
      
      business:
        type: "object"
        required: ["name", "entityType"]
        properties:
          name:
            type: "string"
            minLength: 2
            maxLength: 200
          entityType:
            type: "string"
            enum: ["LLC", "Corporation", "Sole Proprietorship", "Partnership"]
          ein:
            type: "string"
            pattern: "^[0-9]{2}-[0-9]{7}$"
            description: "Federal Employer Identification Number"
  
  # PRD Lines 680-690: Success criteria
  success_criteria:
    required:
      - "user.firstName != null"
      - "user.email != null"
      - "business.name != null"
      - "business.entityType != null"
    
    optional:
      - "business.ein != null"
      - "integrations.quickbooks == true"
  
  # PRD Lines 693-698: Constraints
  constraints:
    maxDuration: 300  # 5 minutes
    maxUserInputRequests: 5
    requiredAgents:
      - "orchestrator"
      - "data_collection"
      
# ============================================================================
# EXECUTION HINTS (Not in PRD but useful for orchestrator)
# ============================================================================
execution_hints:
  # Progressive disclosure ordering
  ui_optimization:
    priority_fields:
      - "user.email"  # Can unlock other data
      - "business.name"  # Can search public records
      - "business.entityType"  # Determines requirements
    
    conditional_fields:
      ein:
        show_when: "business.entityType IN ['LLC', 'Corporation']"
        
  # Data source priorities
  data_sources:
    user_info:
      1: "google_oauth"  # Try first
      2: "existing_profile"  # Check database
      3: "user_input"  # Last resort
      
    business_info:
      1: "quickbooks_import"  # If connected
      2: "public_records"  # CA SOS search
      3: "user_input"  # Manual entry
      
# ============================================================================
# TODO [POST-MVP] ENHANCEMENTS
# ============================================================================
# TODO: Add webhook triggers for automated onboarding (PRD:1684)
# TODO: Add scheduled re-verification of business data (PRD:1685)
# TODO: Add parallel agent execution for faster completion (PRD:1679)
# TODO: Add ML-based field prediction from partial data